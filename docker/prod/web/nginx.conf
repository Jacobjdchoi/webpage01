upstream rails_app {  
    server prodbe:3000;
} 
server {  
    listen 80;
    # define your domain  
    server_name localhost www.example.com;   
    # define the public application root  
    root   /var/www/samtra/public;
    index  index.html;   
    # define where Nginx should write its logs  
    access_log /var/www/samtra/log/nginx.access.log;  
    error_log /var/www/samtra/log/nginx.error.log;   

    # deny requests for files that should never be accessed
    location ~ \.css {
        add_header Content-Type text/css;
    }
    location ~ \.js {
        add_header Content-Type application/x-javascript;
    }
    location ~ \.png {
        add_header Content-Type image/png;
    }
    location ~ \.jpg {
        add_header Content-Type image/jpeg;
    } 
    location ~ /\. {    
        deny all;  
    }   
    location ~* ^.+\.(rb|log)$ {    
        deny all;  
    }  
 
    # serve static (compiled) assets directly if they exist (for rails production)  
    location ~ ^/(assets|images|javascripts|stylesheets|swfs|system)/   {    
        try_files $uri @rails;     
        access_log off;    
        # gzip_static on;
        gzip on;
        gzip_disable "msie6";
        gzip_vary on;
        gzip_proxied any;
        gzip_comp_level 6;
        gzip_buffers 16 8k;
        gzip_http_version 1.1;
        gzip_min_length 256;
        gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/vnd.ms-fontobject application/x-font-ttf font/opentype image/svg+xml image/x-icon;
        # to serve pre-gzipped version     
        expires max;    
        add_header Cache-Control public;     
        
        add_header Last-Modified "";    
        add_header ETag "";    
        break;  
    }

    

    # send non-static file requests to the app server  
    location / {    
        try_files $uri @rails;  
    }

    location @rails {    
        proxy_set_header  X-Real-IP  $remote_addr;    
        proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;         
        proxy_set_header Host $http_host;    
        proxy_redirect off;    
        proxy_pass http://rails_app;  
    }
}

# upstream rails_app {
#   server 127.0.0.1:3000;
# }
 
# server {

#     gzip  on;
#     gzip_disable "msie6";
#     gzip_vary on;
#     gzip_proxied any;
#     gzip_comp_level 6;
#     gzip_buffers 16 8k;
#     gzip_http_version 1.1;
#     gzip_min_length 256;
#     gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/vnd.ms-fontobject application/x-font-ttf font/opentype image/svg+xml image/x-icon;
 
#   listen 80;
 
#   client_max_body_size 4G;
#   keepalive_timeout 10;
 
#   error_page 500 502 504 /500.html;
#   error_page 503 @503;
 
#   server_name localhost samtra 127.0.0.1;
#   root /var/www/samtra/public;
#   try_files $uri/index.html $uri @rails;
 
#   location @rails {
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header Host $http_host;
#     proxy_redirect off;
 
#     proxy_pass http://rails_app;
#     # limit_req zone=one;
#     access_log /var/www/samtra/log/nginx.access.log;
#     error_log /var/www/samtra/log/nginx.error.log;
#   }
 
#   location ^~ /assets/ {
#     gzip_static on;
#     expires max;
#     add_header Cache-Control public;
#   }
 
#   location = /50x.html {
#     root html;
#   }
 
#   location = /404.html {
#     root html;
#   }
 
#   location @503 {
#     error_page 405 = /system/maintenance.html;
#     if (-f $document_root/system/maintenance.html) {
#       rewrite ^(.*)$ /system/maintenance.html break;
#     }
#     rewrite ^(.*)$ /503.html break;
#   }
 
#   if ($request_method !~ ^(GET|HEAD|PUT|PATCH|POST|DELETE|OPTIONS)$ ){
#     return 405;
#   }
 
#   if (-f $document_root/system/maintenance.html) {
#     return 503;
#   }
 
#   location ~ \.(php|html)$ {
#     return 405;
#   }
# }
